const errors = require('restify-errors');
const { APP_TOKEN } = process.env;
module.exports = (request, response, next) => {
    const urlObj = new URL(request.url, 'http://0.0.0.0/');
    const token = urlObj.searchParams.get('token');
    if (!token) {
        return next(new errors.UnauthorizedError('missing token'));
    }
    if (token !== APP_TOKEN) {
        throw next(new errors.UnauthorizedError('invalid token'));
    }
    next();
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVxdWVzdC12YWxpZGF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlcy9yZXF1ZXN0LXZhbGlkYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ3pDLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO0FBRWxDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFO0lBQzNDLE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztJQUN2RCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUUvQyxJQUFJLENBQUMsS0FBSyxFQUFFO1FBQ1YsT0FBTyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztLQUM1RDtJQUVELElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtRQUN2QixNQUFNLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0tBQzNEO0lBRUQsSUFBSSxFQUFFLENBQUM7QUFDVCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBlcnJvcnMgPSByZXF1aXJlKCdyZXN0aWZ5LWVycm9ycycpO1xuY29uc3QgeyBBUFBfVE9LRU4gfSA9IHByb2Nlc3MuZW52O1xuXG5tb2R1bGUuZXhwb3J0cyA9IChyZXF1ZXN0LCByZXNwb25zZSwgbmV4dCkgPT4ge1xuICBjb25zdCB1cmxPYmogPSBuZXcgVVJMKHJlcXVlc3QudXJsLCAnaHR0cDovLzAuMC4wLjAvJyk7XG4gIGNvbnN0IHRva2VuID0gdXJsT2JqLnNlYXJjaFBhcmFtcy5nZXQoJ3Rva2VuJyk7XG5cbiAgaWYgKCF0b2tlbikge1xuICAgIHJldHVybiBuZXh0KG5ldyBlcnJvcnMuVW5hdXRob3JpemVkRXJyb3IoJ21pc3NpbmcgdG9rZW4nKSk7XG4gIH1cblxuICBpZiAodG9rZW4gIT09IEFQUF9UT0tFTikge1xuICAgIHRocm93IG5leHQobmV3IGVycm9ycy5VbmF1dGhvcml6ZWRFcnJvcignaW52YWxpZCB0b2tlbicpKTtcbiAgfVxuXG4gIG5leHQoKTtcbn07XG4iXX0=