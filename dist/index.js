/* eslint-disable no-process-exit, require-await */
'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fastify_1 = __importDefault(require("fastify"));
const fastify_sensible_1 = __importDefault(require("fastify-sensible"));
const fastify_helmet_1 = __importDefault(require("fastify-helmet"));
const fastify_raw_body_1 = __importDefault(require("fastify-raw-body"));
const validate_request_1 = __importDefault(require("./hooks/validate-request"));
const validate_tito_payload_1 = __importDefault(require("./hooks/validate-tito-payload"));
const { PORT = 8000 } = process.env;
const server = fastify_1.default({
    logger: true,
});
server.register(fastify_sensible_1.default);
server.register(fastify_helmet_1.default);
server.register(fastify_raw_body_1.default);
server.addHook('preHandler', validate_request_1.default);
server.addHook('preHandler', validate_tito_payload_1.default);
server.addHook('preHandler', async (request, reply) => {
    //console.log('pre-handling', request)
    console.log(request);
    return;
});
server.post('/register-purchase/', async () => ({ hello: 'world' }));
const start = async () => {
    try {
        await server.listen(PORT);
    }
    catch (err) {
        server.log.error(err);
        process.exit(1);
    }
};
start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsbURBQW1EO0FBQ25ELFlBQVksQ0FBQzs7Ozs7QUFDYixzREFBOEI7QUFDOUIsd0VBQXVDO0FBQ3ZDLG9FQUFtQztBQUNuQyx3RUFBc0M7QUFFdEMsZ0ZBQXNEO0FBQ3RELDBGQUErRDtBQUUvRCxNQUFNLEVBQUUsSUFBSSxHQUFHLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7QUFFcEMsTUFBTSxNQUFNLEdBQUcsaUJBQU8sQ0FBQztJQUNyQixNQUFNLEVBQUUsSUFBSTtDQUNiLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxRQUFRLENBQUMsMEJBQVEsQ0FBQyxDQUFBO0FBQ3pCLE1BQU0sQ0FBQyxRQUFRLENBQUMsd0JBQU0sQ0FBQyxDQUFBO0FBQ3ZCLE1BQU0sQ0FBQyxRQUFRLENBQUMsMEJBQU8sQ0FBQyxDQUFBO0FBRXhCLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLDBCQUFlLENBQUMsQ0FBQTtBQUM3QyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSwrQkFBbUIsQ0FBQyxDQUFBO0FBQ2pELE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUU7SUFDcEQsc0NBQXNDO0lBRXRDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7SUFFcEIsT0FBTTtBQUNSLENBQUMsQ0FBQyxDQUFBO0FBRUYsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBRXJFLE1BQU0sS0FBSyxHQUFHLEtBQUssSUFBSSxFQUFFO0lBQ3ZCLElBQUk7UUFDRixNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDM0I7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNaLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDakI7QUFDSCxDQUFDLENBQUM7QUFDRixLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLXByb2Nlc3MtZXhpdCwgcmVxdWlyZS1hd2FpdCAqL1xuJ3VzZSBzdHJpY3QnO1xuaW1wb3J0IGZhc3RpZnkgZnJvbSAnZmFzdGlmeSc7XG5pbXBvcnQgc2Vuc2libGUgZnJvbSAnZmFzdGlmeS1zZW5zaWJsZSdcbmltcG9ydCBoZWxtZXQgZnJvbSAnZmFzdGlmeS1oZWxtZXQnXG5pbXBvcnQgcmF3Qm9keSBmcm9tICdmYXN0aWZ5LXJhdy1ib2R5J1xuXG5pbXBvcnQgdmFsaWRhdGVSZXF1ZXN0IGZyb20gJy4vaG9va3MvdmFsaWRhdGUtcmVxdWVzdCdcbmltcG9ydCB2YWxpZGF0ZVRpdG9QYXlsb2FkIGZyb20gJy4vaG9va3MvdmFsaWRhdGUtdGl0by1wYXlsb2FkJ1xuXG5jb25zdCB7IFBPUlQgPSA4MDAwIH0gPSBwcm9jZXNzLmVudjtcblxuY29uc3Qgc2VydmVyID0gZmFzdGlmeSh7XG4gIGxvZ2dlcjogdHJ1ZSxcbn0pO1xuXG5zZXJ2ZXIucmVnaXN0ZXIoc2Vuc2libGUpXG5zZXJ2ZXIucmVnaXN0ZXIoaGVsbWV0KVxuc2VydmVyLnJlZ2lzdGVyKHJhd0JvZHkpXG5cbnNlcnZlci5hZGRIb29rKCdwcmVIYW5kbGVyJywgdmFsaWRhdGVSZXF1ZXN0KVxuc2VydmVyLmFkZEhvb2soJ3ByZUhhbmRsZXInLCB2YWxpZGF0ZVRpdG9QYXlsb2FkKVxuc2VydmVyLmFkZEhvb2soJ3ByZUhhbmRsZXInLCBhc3luYyAocmVxdWVzdCwgcmVwbHkpID0+IHtcbiAgLy9jb25zb2xlLmxvZygncHJlLWhhbmRsaW5nJywgcmVxdWVzdClcblxuICBjb25zb2xlLmxvZyhyZXF1ZXN0KVxuXG4gIHJldHVyblxufSlcblxuc2VydmVyLnBvc3QoJy9yZWdpc3Rlci1wdXJjaGFzZS8nLCBhc3luYyAoKSA9PiAoeyBoZWxsbzogJ3dvcmxkJyB9KSk7XG5cbmNvbnN0IHN0YXJ0ID0gYXN5bmMgKCkgPT4ge1xuICB0cnkge1xuICAgIGF3YWl0IHNlcnZlci5saXN0ZW4oUE9SVCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHNlcnZlci5sb2cuZXJyb3IoZXJyKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn07XG5zdGFydCgpO1xuLypcbiAqY29uc3QgdmFsaWRhdGVUaXRvID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlcy90aXRvLXZhbGlkYXRlJylcbiAqY29uc3QgdmFsaWRhdGVSZXF1ZXN0ID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlcy9yZXF1ZXN0LXZhbGlkYXRlJylcbiAqXG4gKmNvbnN0IGhhbmRsZVJlZ2lzdHJhdGlvbiA9IHJlcXVpcmUoJy4vaGFuZGxlcnMvcmVnaXN0ZXInKVxuICpcbiAqY29uc3Qgc2VydmVyID0gcmVzdGlmeS5jcmVhdGVTZXJ2ZXIoKTtcbiAqc2VydmVyLnVzZShyZXN0aWZ5LnBsdWdpbnMuYm9keVBhcnNlcigpKVxuICpcbiAqc2VydmVyLnBvc3QoJy9yZWdpc3Rlci1wdXJjaGFzZS8nLCB2YWxpZGF0ZVJlcXVlc3QsIHZhbGlkYXRlVGl0bywgICApO1xuICpzZXJ2ZXIuaGVhZCgnL3JlZ2lzdGVyLXB1cmNoYXNlLycsIHZhbGlkYXRlUmVxdWVzdCwgdmFsaWRhdGVUaXRvLCBoYW5kbGVSZWdpc3RyYXRpb24pO1xuICovXG4iXX0=